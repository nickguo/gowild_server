<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
      <title>GoWild! Banking</title>
      <script src="//code.jquery.com/jquery-1.10.2.js"></script>

    <link href="http://s3.amazonaws.com/codecademy-content/courses/ltp2/css/bootstrap.min.css" rel="stylesheet">
    <%= stylesheet_link_tag "style.css" %>
</head>


<body>
    <div id="header">
        <% if user_signed_in? %>
            <%= link_to('Logout', destroy_user_session_path) %>
        <% else %>
            <%= link_to('Sign up', new_user_registration_path) %>
            <br>
            <%= link_to('Login', new_user_session_path) %>
        <% end %>
    </div>

<div class="background" style="width: 800px">
          <div class = "header" style="height: 130px"><!-- 2-->
              <div class ="logo"><!-- 4-->
                  <img src="/images/logo3.png" style="width: 120px; height: 90px; margin-left:40px;
                      margin-top:20px">
              </div><!-- 4-->
          </div>

          <div class = "bar"><!-- 2-->
            <nav class="navbar navbar-inverse">
                <div class="container-fluid"><!-- 3-->
                    <ul class="nav nav-pills">
                        <li role="presentation"><a href="file:///Applications/XAMPP/xamppfiles/htdocs/CSE110/Account/Account.html">ACCOUNT</a></li>
                        <li role="presentation"><a href="file:///Applications/XAMPP/xamppfiles/htdocs/CSE110/Transfer/Transfer.html">TRANSFER</a></li>
                        <li role="presentation"><a href="file:///Applications/XAMPP/xamppfiles/htdocs/CSE110/Deposit/Deposit.html">DEPOSIT</a></li>
                        <li role="presentation"><a href="file:///Applications/XAMPP/xamppfiles/htdocs/CSE110/Withdraw/Withdraw.html">WITHDRAW</a></li>
                        <li role="presentation"><%= link_to('LOGOUT', destroy_user_session_path)%></a></li>
                    </ul>
                </div><!-- 3-->
            </nav>
          </div><!-- 2-->
          
          <div class = "intro">
              <img src = "/images/hehe.jpg" style = "width:650px">
          </div>
<%= yield %>


<% if user_signed_in? %>

<div class="welcome">
<table>
<% if current_user.account_type == 'user' %>
    <thead>
    <h1>Account Balances</h1>
    <% if current_user.accounts.count <= 0 %>
        <th>No accounts found, please contact your local teller!</th>
    <% else %>
        <tr>
        <th style="padding:0 45px 0 45px">Account Type</th>
        <th style="padding:0 45px 0 45px">Account Number</th>
        <th style="padding:0 45px 0 45px">Balance</th>
        <th colspan="2"></th>
        </tr>
    <% end %>
    </thead>
<% end %>

<tbody>
    <% if current_user.account_type == "teller" %>
        <div> WELCOME TELLER </div>
        <%= form_for current_user do |f| %>
            <%= f.select :from_account, Account.all.collect {|account| [account.account_number.to_s + " - $" + account.balance.to_s, account.id]}, :prompt => "Select account to transfer from" %>
            <%= f.select :to_account, Account.all.collect {|account| [account.account_number.to_s + " - $" + account.balance.to_s, account.id]}, :prompt => "Select account to transfer to" %>

            <%= text_field_tag 'amount', '0'%>
            <%= f.hidden_field 'id' %>
            <%= f.submit 'transfer' %>
            <script>
                $("#from_email").change( function() {
                    var selectopt = $(this.children[this.selectedIndex]);
                });
            </script>
        <% end %>
        <br />
        <br />
        <br />

        <%= form_for current_user do |f| %>
            <%= f.select :from_account, Account.all.collect {|account| [account.account_number.to_s + " - updated on " + account.interest_date.strftime("%m/%d/%Y"), account.id]}, :prompt => "Select account to calculate interest for" %>
            <%= f.hidden_field 'id' %>
            <%= f.submit 'calculate interest' %>
            <script>
                $("#from_email").change( function() {
                    var selectopt = $(this.children[this.selectedIndex]);
                });
            </script>
        <% end %>


    <% else %>
        <% if current_user.accounts.count != 0 %>
            <% current_user.accounts.each do |acc| %>
                <%= form_for acc do |f| %>
                    <tr>
                    <td align="center"><%= acc.account_type %></td>
                    <td align="center"><%= acc.account_number %></td>
                    <td align="center"><%= sprintf("$%.2f",acc.balance) %></td>
                    <td align="center"><%= text_field_tag 'amount', '0'%></td>
                    <%= f.hidden_field 'id' %>
                    <td><%= f.submit 'Deposit' %></td>
                    <td><button type='button' Class=<%=acc.id%>>Show transactions</button></td>
                    </tr>

                    <% if acc.transactions.count != 0%>
                        <tr align="center">
                        <td class="hidden <%=acc.id%>" style="font-weight:bold">Description</td>
                        <td class="hidden <%=acc.id%>" style="font-weight:bold">By</td>
                        <td class="hidden <%=acc.id%>" style="font-weight:bold">Amount</td>
                        <td class="hidden <%=acc.id%>" style="font-weight:bold">Account Balance</td>
                        <td class="hidden <%=acc.id%>" style="font-weight:bold">Date</td>
                        </tr>
                    <% else %>
                        <tr align="center">
                        <td class="hidden <%=acc.id%>" style="font-weight:bold" colspan="6">No transactions</td>
                        </tr>

                    <% end %>

                    <% acc.transactions.each do |transaction| %>
                    <tr align="center">
                        <td class="hidden <%=acc.id%>"><%= transaction.transaction_type%></td>
                        <td class="hidden <%=acc.id%>"><%= transaction.by%></td>
                        <td class="hidden <%=acc.id%>"><%= sprintf("$%.2f",transaction.amount)%></div></td>
                        <td class="hidden <%=acc.id%>"><%= sprintf("$%.2f",transaction.balance)%></div></td>
                        <td class="hidden <%=acc.id%>"><%= transaction.created_at.strftime("%b. %d, %Y")%></div></td>
                    </tr>
                    <% end %>
                    <script>
                    $( "button."+<%=acc.id%> ).click(function() {
                        $( "td."+<%=acc.id%> ).slideToggle("fast");
                        var el = $(this);
                        el.text() == "Show transactions" ? el.text("Hide transactions") :
                                                           el.text("Show transactions");
                    });
                    </script>

                    <tr class="strikeout">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    </tr>

                <% end %>
            <% end %>
        <% end %>
    <% end %>
</tbody>
</table>
<% else %>
    <div>Not signed in </div>
<% end %>

</div>

</body>


</html>
